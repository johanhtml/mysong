<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
    <title>Playlist "Joan"</title>
    <link
      href="https://fonts.googleapis.com/css2?family=Gochi+Hand&family=Comic+Neue:wght@400;700&display=swap"
      rel="stylesheet"
    />

    <style>
        /* Base styles & pastel theme (CSS dipotong untuk keringkasan, menggunakan CSS yang sama dengan sebelumnya) */
        html,
        body {
            margin: 0;
            padding: 0;
            font-family: "Gochi Hand", cursive;
            overflow-x: hidden;
        }

        @keyframes backgroundShift {
            0% {
                background-position: 0% 50%;
            }
            50% {
                background-position: 100% 50%;
            }
            100% {
                background-position: 0% 50%;
            }
        }
        @keyframes pulse {
            0% {
                transform: scale(1);
            }
            50% {
                transform: scale(1.1);
            }
            100% {
                transform: scale(1);
            }
        }
        
        body {
            display: flex;
            justify-content: center;
            align-items: center;
            min-height: 100vh;
            
            background-size: 400% 400%; 
            background: linear-gradient(135deg, #fce9e9 0%, #ffffff 80%); 
            animation: backgroundShift 15s ease infinite; 

            transition: background-color 0.8s ease;
            text-align: center;
        }

        .container {
            background: #ffffff; 
            border-radius: 16px;
            padding: 30px;
            width: 90%;
            max-width: 1000px;
            
            box-shadow: 8px 8px 16px rgba(189, 195, 199, 0.4), 
                        -8px -8px 16px rgba(255, 255, 255, 0.9);
            border: none; 

            display: flex;
            align-items: center;
            gap: 30px;
            opacity: 0;
            animation: fadeIn 0.8s ease forwards;
            transition: background-color 0.8s ease, box-shadow 0.8s ease;
        }

        @keyframes fadeIn {
            to {
                opacity: 1;
            }
        }

        .left-side {
            flex-shrink: 0;
            text-align: center;
        }

        .left-side h1 {
            margin: 0;
            font-size: 3.5rem;
            font-family: "Comic Neue", cursive;
            font-weight: 700;
            transition: color 0.8s ease;
        }

        .left-side p {
            margin-top: 8px;
            font-size: 1.4rem;
            opacity: 0.75;
            transition: color 0.8s ease;
        }

        .right-side {
            position: relative;
            flex: 1;
        }

        input[type="radio"] {
            display: none;
        }

        .cards {
            position: relative;
            width: 100%;
            height: 300px;
            margin-bottom: 20px;
        }

        .card {
            position: absolute;
            width: 60%;
            height: 100%;
            left: 0;
            right: 0;
            margin: auto;
            border-radius: 14px;
            box-shadow: 4px 4px 8px rgba(0, 0, 0, 0.08); 
            border: none; 
            background-color: #ddd;
            display: flex;
            justify-content: center;
            align-items: center;
            transition: transform 0.4s ease, opacity 0.4s ease, filter 0.4s ease; 
            cursor: pointer;
        }

        .card:hover {
            transform: scale(1.05);
        }

        .card img {
            width: 90%;
            height: 80%;
            object-fit: cover;
            border-radius: 10px;
        }

        /* SLIDER LOGIC */
        #item-1:checked ~ .cards #song-4,
        #item-2:checked ~ .cards #song-1,
        #item-3:checked ~ .cards #song-2,
        #item-4:checked ~ .cards #song-3 {
            transform: translateX(-40%) scale(0.8);
            opacity: 0.4;
            z-index: 0;
            filter: blur(2px); 
        }
        
        #item-1:checked ~ .cards #song-2,
        #item-2:checked ~ .cards #song-3,
        #item-3:checked ~ .cards #song-4,
        #item-4:checked ~ .cards #song-1 {
            transform: translateX(40%) scale(0.8);
            opacity: 0.4;
            z-index: 0;
            filter: blur(2px); 
        }

        #item-1:checked ~ .cards #song-1,
        #item-2:checked ~ .cards #song-2,
        #item-3:checked ~ .cards #song-3,
        #item-4:checked ~ .cards #song-4 {
            transform: translateX(0) scale(1);
            opacity: 1;
            z-index: 1;
            filter: blur(0); 
        }

        .player {
            margin-top: 20px;
            border-radius: 14px;
            background-color: #f0f0f0; 
            color: #333;
            padding: 20px;
            box-shadow: inset 5px 5px 10px rgba(189, 195, 199, 0.4), 
                        inset -5px -5px 10px rgba(255, 255, 255, 0.9); 
            transition: background-color 0.8s ease, box-shadow 0.8s ease, color 0.8s ease;
            text-align: left;
            position: relative;
        }

        .song-info {
            display: none;
        }

        .song-info.active {
            display: block;
        }

        .song-info .title {
            font-size: 1.6rem;
            font-family: "Comic Neue", cursive;
            font-weight: 700;
            margin-bottom: 5px;
            transition: color 0.8s ease;
        }

        .song-details {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 5px;
            font-size: 1.1rem;
            font-family: "Comic Neue", cursive;
        }

        .song-details .artist {
            text-align: left;
        }

        .song-details .duration {
            text-align: right;
        }

        .personal-note {
            font-size: 0.95rem;
            font-style: italic;
            opacity: 0.8;
            margin: 8px 0 0 0;
            transition: color 0.8s ease;
            font-family: 'Comic Neue', cursive;
        }

        .time-indicator {
            font-size: 1rem;
            margin-top: 3px;
            display: flex;
            justify-content: space-between;
            font-family: "Comic Neue", cursive;
            color: inherit;
        }

        .progress-bar {
            height: 8px; 
            width: 100%;
            background-color: #e0e0e0;
            border-radius: 4px;
            margin-top: 10px;
            overflow: hidden;
            cursor: pointer; 
        }

        .progress {
            height: 100%;
            width: 0%;
            border-radius: 4px;
            background-color: #777;
            transition: width 0.1s linear;
        }

        .controls {
            display: flex;
            justify-content: center;
            gap: 20px;
            margin-top: 15px;
        }

        .controls button {
            background: #e0e0e0; 
            border: none;
            font-size: 2.5rem;
            cursor: pointer;
            border-radius: 50%; 
            width: 60px;
            height: 60px;
            display: flex;
            justify-content: center;
            align-items: center;
            box-shadow: 4px 4px 8px rgba(189, 195, 199, 0.4), 
                        -4px -4px 8px rgba(255, 255, 255, 0.9); 
            transition: transform 0.3s ease, color 0.8s ease, box-shadow 0.3s ease, background 0.8s ease;
        }

        .controls button:active {
            box-shadow: inset 2px 2px 5px rgba(189, 195, 199, 0.4), 
                        inset -2px -2px 5px rgba(255, 255, 255, 0.9); 
        }
        
        .controls button#pause.pulsing {
            animation: pulse 1s infinite ease-in-out;
        }

        .extra-controls {
            margin-top: 15px;
            display: flex;
            justify-content: flex-start; 
            align-items: center;
            font-family: "Comic Neue", cursive;
            gap: 15px;
        }
        .extra-controls > *:last-child {
            margin-left: auto; 
        }

        .favorite-btn {
            background: #e0e0e0; 
            border: none;
            font-size: 2rem;
            cursor: pointer;
            color: #777;
            border-radius: 50%;
            width: 45px;
            height: 45px;
            display: flex;
            justify-content: center;
            align-items: center;
            box-shadow: 3px 3px 6px rgba(189, 195, 199, 0.4), 
                        -3px -3px 6px rgba(255, 255, 255, 0.9);
            transition: color 0.3s ease, box-shadow 0.3s ease, background 0.8s ease;
        }
        .favorite-btn:active {
            box-shadow: inset 2px 2px 5px rgba(189, 195, 199, 0.4), 
                        inset -2px -2px 5px rgba(255, 255, 255, 0.9);
        }
        .favorite-btn.favorited {
            color: red;
        }

        .volume-control {
            display: flex;
            align-items: center;
            gap: 8px;
        }

        #volume-icon {
            font-size: 1.5rem;
            background: none;
            border: none;
            cursor: pointer;
            color: inherit;
            padding: 0;
            transition: color 0.8s ease;
        }

        #volume-slider {
            width: 80px;
            height: 4px;
            -webkit-appearance: none;
            background: #bbb;
            border-radius: 2px;
            cursor: pointer;
        }

        #lyrics-btn {
            background: #e0e0e0; 
            border: none;
            font-size: 1.1rem;
            cursor: pointer;
            color: #333;
            padding: 10px 15px;
            border-radius: 8px;
            box-shadow: 3px 3px 6px rgba(189, 195, 199, 0.4), 
                        -3px -3px 6px rgba(255, 255, 255, 0.9);
            transition: color 0.3s ease, box-shadow 0.3s ease, background 0.8s ease;
            font-family: 'Comic Neue', cursive;
            flex-shrink: 0; 
        }
        #lyrics-btn:active {
            box-shadow: inset 2px 2px 5px rgba(189, 195, 199, 0.4), 
                        inset -2px -2px 5px rgba(255, 255, 255, 0.9);
        }

        .modal-overlay {
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: rgba(0, 0, 0, 0.4);
            display: none;
            justify-content: center;
            align-items: center;
            z-index: 9999;
        }

        .modal-content {
            padding: 20px;
            border-radius: 14px;
            font-family: "Comic Neue", cursive;
            color: #333;
            box-shadow: 8px 8px 16px rgba(189, 195, 199, 0.4), 
                        -8px -8px 16px rgba(255, 255, 255, 0.9);
            max-width: 320px;
            border: none;
            text-align: center;
            animation: popIn 0.5s ease-out;
            max-height: 80vh; 
            overflow-y: auto; 
        }
        
        #lyricsModal .modal-content {
            text-align: left;
            padding-bottom: 50px; 
            max-width: 90%;
            width: 500px;
        }

        #lyricsModal h2 {
            text-align: center;
            margin-bottom: 20px;
        }

        #lyrics-text {
            white-space: pre-wrap; 
            font-size: 0.9rem;
            line-height: 1.6;
        }

        .lyrics-line {
            transition: opacity 0.3s ease, color 0.3s ease;
            opacity: 0.5; 
            margin-bottom: 8px; 
            font-family: 'Comic Neue', cursive;
        }

        .lyrics-line.active {
            font-weight: 700;
            font-size: 1.1rem; 
            opacity: 1; 
            color: inherit; 
        }
        
        @keyframes popIn {
            from {
                transform: scale(0.5);
                opacity: 0;
            }
            to {
                transform: scale(1);
                opacity: 1;
            }
        }

        .modal-content h2 {
            margin-top: 0;
            font-size: 2rem;
        }

        .modal-content p {
            font-size: 1.1rem;
        }

        .modal-close {
            background: #e0e0e0; 
            border: none;
            padding: 10px 20px;
            border-radius: 8px;
            margin-top: 15px;
            cursor: pointer;
            font-family: "Comic Neue", cursive;
            font-size: 1.1rem;
            box-shadow: 3px 3px 6px rgba(189, 195, 199, 0.4), 
                        -3px -3px 6px rgba(255, 255, 255, 0.9);
            transition: background-color 0.3s ease, color 0.3s ease, box-shadow 0.3s ease;
            color: #333;
        }
        .modal-close:hover {
            box-shadow: inset 2px 2px 5px rgba(189, 195, 199, 0.4), 
                        inset -2px -2px 5px rgba(255, 255, 255, 0.9);
        }

        #lyricsModal .modal-close {
            position: sticky;
            bottom: 10px;
            margin-top: 20px;
            width: calc(100% - 40px); 
            left: 20px;
            right: 20px;
        }

        /* Media Query for Tablets/Phones (dipotong untuk keringkasan) */
        @media (max-width: 768px) {
            .container {
                flex-direction: column;
                width: calc(100% - 40px);
                padding: 20px;
                gap: 20px;
            }

            .cards {
                height: 220px;
            }

            .card {
                width: 70%;
                height: 100%;
            }

            .controls button {
                font-size: 2rem;
                width: 50px;
                height: 50px;
            }
            #lyrics-btn {
                font-size: 0.9rem;
                padding: 8px 12px;
            }
            .favorite-btn {
                width: 40px;
                height: 40px;
                font-size: 1.8rem;
            }

            .left-side h1 {
                font-size: 2.5rem;
            }

            .left-side p {
                font-size: 1.2rem;
            }
        }

        @media (max-width: 480px) {
            .cards {
                height: 180px;
            }

            .card {
                width: 80%;
            }

            .controls button {
                font-size: 1.8rem;
                width: 45px;
                height: 45px;
            }
        }
    </style>
    </head>
  <body>
    <div class="modal-overlay" id="notificationModal">
      <div class="modal-content" id="modalContent">
        <h2>Joan sent you a playlist</h2>
        <p>Hey, it‚Äôs for you. I hope you listen to it.</p>
        <button class="modal-close" onclick="closeModal('notificationModal')">Open Playlist</button>
      </div>
    </div>

    <div class="modal-overlay" id="lyricsModal">
      <div class="modal-content" id="lyricsModalContent">
        <h2 id="lyrics-title"></h2>
        <div id="lyrics-text"></div>
        <button class="modal-close" onclick="closeModal('lyricsModal')">Close Lyrics</button>
      </div>
    </div>
    
    <div class="container">
      <div class="left-side">
        <h1>Playlist Joan</h1>
        <p>Songs that remind me of you</p>
      </div>
      <div class="right-side">
        <input type="radio" name="slider" id="item-1" checked />
        <input type="radio" name="slider" id="item-2" />
        <input type="radio" name="slider" id="item-3" />
        <input type="radio" name="slider" id="item-4" />

        <div class="cards">
          <label class="card" for="item-1" id="song-1">
            <img src="https://raw.githubusercontent.com/johanhtml/johanwirawan/refs/heads/main/happier.jpeg" alt="Happier" />
          </label>
          <label class="card" for="item-2" id="song-2">
            <img src="https://raw.githubusercontent.com/johanhtml/johanwirawan/refs/heads/main/happines.jpg" alt="Happiness" />
          </label>
          <label class="card" for="item-3" id="song-3">
            <img src="https://raw.githubusercontent.com/johanhtml/johanwirawan/refs/heads/main/happy.jpeg" alt="Happy" />
          </label>
          <label class="card" for="item-4" id="song-4">
            <img src="https://raw.githubusercontent.com/johanhtml/johanwirawan/refs/heads/main/neeckdeep.jpeg" alt="Wish You Were Here" />
          </label>
        </div>

        <div class="player">
          <div class="song-info active" id="song-info-1">
            <div class="title">Happier</div>
            <div class="song-details">
              <span class="artist">Olivia Rodrigo</span>
              <span class="duration">2:55</span>
            </div>
            <p class="personal-note">"How's your day stranger?" .</p>
            <audio id="audio-1" src="https://raw.githubusercontent.com/johanhtml/johanwirawan/main/Olivia%20Rodrigo%20-%20Happier.mp3"></audio>
            <div class="progress-bar">
              <div class="progress"></div>
            </div>
            <div class="time-indicator">
              <span class="elapsed">0:00</span>
              <span class="remaining">-2:55</span>
            </div>
          </div>
          <div class="song-info" id="song-info-2">
            <div class="title">Happiness</div>
            <div class="song-details">
              <span class="artist">Rex Orange County</span>
              <span class="duration">4:30</span>
            </div>
            <p class="personal-note">maybe in another life we ‚Äã‚Äãare together..</p>
            <audio id="audio-2" src="https://raw.githubusercontent.com/johanhtml/johanwirawan/main/Happiness%20-%20Rex%20Orange%20County%20(Lirik%20Dan%20Terjemahan%20Bahasa%20Indonesia).mp3"></audio>
            <div class="progress-bar">
              <div class="progress"></div>
            </div>
            <div class="time-indicator">
              <span class="elapsed">0:00</span>
              <span class="remaining">-4:30</span>
            </div>
          </div>
          <div class="song-info" id="song-info-3">
            <div class="title">Happy</div>
            <div class="song-details">
              <span class="artist">Skinnyfabs</span>
              <span class="duration">3:04</span>
            </div>
            <p class="personal-note">I hope you always feel this emotion, regardless of who is by your side.</p>
            <audio id="audio-3" src="https://raw.githubusercontent.com/johanhtml/johanwirawan/main/skinnyfabs%20-%20happy%20(audio).mp3"></audio>
            <div class="progress-bar">
              <div class="progress"></div>
            </div>
            <div class="time-indicator">
              <span class="elapsed">0:00</span>
              <span class="remaining">-3:04</span>
            </div>
          </div>
          <div class="song-info" id="song-info-4">
            <div class="title">Wish You Were Here</div>
            <div class="song-details">
              <span class="artist">Neck Deep</span>
              <span class="duration">4:00</span>
            </div>
            <p class="personal-note">A song for when I miss you. No other words needed.</p>
            <audio id="audio-4" src="https://raw.githubusercontent.com/johanhtml/johanwirawan/main/Wish%20You%20Were%20Here%20-%20Neck%20Deep%20(Lirik%20Lagu%20Terjemahan).mp3"></audio>
            <div class="progress-bar">
              <div class="progress"></div>
            </div>
            <div class="time-indicator">
              <span class="elapsed">0:00</span>
              <span class="remaining">-4:00</span>
            </div>
          </div>

          <div class="controls">
            <button id="prev">‚óÅ</button>
            <button id="pause">‚ñ∫</button>
            <button id="next">‚ñ∑</button>
          </div>
          <div class="extra-controls">
            <button id="lyrics-btn">Lyrics</button>
            <div class="volume-control">
              <button id="volume-icon">üîä</button>
              <input type="range" id="volume-slider" min="0" max="1" step="0.01" value="1" title="Volume">
            </div>
            <button id="favorite" class="favorite-btn">‚ô°</button>
          </div>
        </div>
      </div>
    </div>


    <script>
        // --- LYRICS DATA DIPERBARUI SECARA FINAL ---
        const lyricsData = [
            {
                title: "Happier - Olivia Rodrigo",
                timedLyrics: [
                    { time: 1.12, text: "" },
                    { time: 1.76, text: "" },
                    { time: 5.29, text: "We broke up a month ago" },
                    { time: 8.60, text: "Your friends are mine" },
                    { time: 10.77, text: "You know I know you've moved on" },
                    { time: 14.00, text: "Found someone new" },
                    { time: 15.73, text: "One more girl who brings out the better in you" },
                    { time: 21.36, text: "And I thought my heart was detached" },
                    { time: 25.22, text: "From all the sunlight of our past" },
                    { time: 29.52, text: "But she's so sweet" },
                    { time: 31.83, text: "She's so pretty" },
                    { time: 34.03, text: "Does she mean you forgot about me?" },
                    { time: 38.43, text: "Oh, I hope you're happy" },
                    { time: 42.48, text: "But not like how you were with me" },
                    { time: 46.47, text: "I'm selfish, I know" },
                    { time: 48.92, text: "I can't let you go" },
                    { time: 50.93, text: "So find someone great but don't find no one better" },
                    { time: 55.24, text: "I hope you're happy but don't be happier" },
                    { time: 62.59, text: "And do you tell her she's the most beautiful girl you've ever seen?" },
                    { time: 67.19, text: "An eternal love bullshit you know you'll never mean" },
                    { time: 71.62, text: "Remember when I believed" },
                    { time: 73.68, text: "You meant it when you said it first to me" },
                    { time: 78.72, text: "And now I'm pickin' her apart" },
                    { time: 82.70, text: "Like cuttin' her down, make you miss my wretched heart" },
                    { time: 86.88, text: "But she's beautiful" },
                    { time: 88.84, text: "She looks kind" },
                    { time: 90.98, text: "She probably gives you butterflies" },
                    { time: 95.63, text: "I hope you're happy" },
                    { time: 99.76, text: "But not like how you were with me" },
                    { time: 104.11, text: "I'm selfish, I know" },
                    { time: 106.21, text: "I can't let you go" },
                    { time: 108.38, text: "So find someone great but don't find no one better" },
                    { time: 112.56, text: "I hope you're happy" },
                    { time: 116.68, text: "I wish you all the best" },
                    { time: 119.86, text: "Really" },
                    { time: 121.07, text: "Say you love her, baby" },
                    { time: 123.10, text: "Just not like you love me" },
                    { time: 125.11, text: "And think of me fondly when your hand's around her" },
                    { time: 129.44, text: "I hope you're happy" },
                    { time: 131.58, text: "But don't be happier" },
                    { time: 152.33, text: "I hope you're happy" },
                    { time: 156.93, text: "Just not like how you were with me" },
                    { time: 160.25, text: "I'm selfish, I know" },
                    { time: 162.47, text: "I can't let you go" },
                    { time: 164.73, text: "So find someone great but don't find no one better" },
                    { time: 168.87, text: "I hope you're happy but don't be happier" },
                    { time: 175.00, text: "(End of Song)" }
                ]
            },
            {
                title: "Happiness - Rex Orange County",
                timedLyrics: [
                    { time: 0.12, text: "I'll be the one" },
                    { time: 3.24, text: "That stays 'till the end" },
                    { time: 6.88, text: "And I'll be the one" },
                    { time: 10.10, text: "That needs you again" },
                    { time: 13.49, text: "And I'll be the one that proposes" },
                    { time: 18.61, text: "In a garden of roses" },
                    { time: 22.23, text: "And truly loves you long after our curtain closes" },
                    { time: 28.68, text: "" },
                    { time: 28.84, text: "But will you still love me" },
                    { time: 31.97, text: "When nobody wants me around?" },
                    { time: 41.36, text: "When I turn 81 and forget things" },
                    { time: 47.69, text: "Will you still be proud?" },
                    { time: 54.53, text: "Cause I am the one" },
                    { time: 57.56, text: "That waited this long" },
                    { time: 61.11, text: "" },
                    { time: 61.27, text: "And I am the one" },
                    { time: 64.34, text: "That might get it wrong" },
                    { time: 68.06, text: "And I'll be the one" },
                    { time: 70.65, text: "That will love you" },
                    { time: 72.79, text: "The way I'm supposed to, girl" },
                    { time: 82.56, text: "But will you still love me" },
                    { time: 86.44, text: "When nobody wants me around, around?" },
                    { time: 96.32, text: "When I turn 81 and forget things" },
                    { time: 101.70, text: "Will you still be proud?" },
                    { time: 109.55, text: "" },
                    { time: 109.82, text: "Proud of me, of my short list of accomplishments" },
                    { time: 116.72, text: "Me and my lack of new news" },
                    { time: 123.89, text: "Me and my selfishness" },
                    { time: 127.28, text: "Or me and myself wish you nothing but a happy new version of you" },
                    { time: 137.16, text: "Because I, I, I" },
                    { time: 143.20, text: "" },
                    { time: 151.23, text: "I want you to tell me you find it hard to be yourself" },
                    { time: 158.21, text: "So I can say it's gonna be alright" },
                    { time: 164.52, text: "And I want you to love me the way you love your family" },
                    { time: 171.39, text: "The way you love to show me what it's like to be happy" },
                    { time: 185.04, text: "(End of Song)" }
                ]
            },
            {
                title: "Happy - Skinnyfabs",
                timedLyrics: [
                    { time: 4.25, text: "" },
                    { time: 10.87, text: "Living all alone kinda forgot it's been that long" },
                    { time: 15.25, text: "Since someone's gone" },
                    { time: 17.10, text: "I've been trying to be a little bit strong" },
                    { time: 21.77, text: "And it is not that easy to be exactly who I was" },
                    { time: 26.43, text: "My shit is done" },
                    { time: 28.18, text: "Now it's time for me try to moving on" },
                    { time: 32.13, text: "'Cause if you think I'm such a happy person, no" },
                    { time: 36.05, text: "You are wrong by saying my laughter is" },
                    { time: 39.57, text: "Louder than yours, shut your freakin' mouth" },
                    { time: 42.57, text: "No one knows what I feel and what I suffer" },
                    { time: 46.58, text: "No they dont know, so keep your thoughts" },
                    { time: 49.87, text: "And stop assuming that, someone is always fine" },
                    { time: 53.00, text: "(Interlude)" }, 
                    { time: 76.00, text: "..." }, // BARIS PERBAIKAN SINKRONISASI AKHIR
                    { time: 76.00, text: "I keep thinking why my friends left me" }, 
                    { time: 79.15, text: "I can go insane" }, 
                    { time: 81.16, text: "Mom was right about that and now I can't trust again" }, 
                    { time: 86.19, text: "But I think I don't really need no" },
                    { time: 89.97, text: "Friends I'm alone and it's not that bad" },
                    { time: 94.09, text: "Then again it hurts me so bad and people just don't know that" },
                    { time: 98.96, text: "Maybe this time, I'ma take back what is mine" },
                    { time: 105.69, text: "All the smiles, all the joys are still mine (are still mine)" },
                    { time: 110.82, text: "There will be no more cryin'" },
                    { time: 112.58, text: "There will be no more tryin'" },
                    { time: 115.45, text: "These places I never belong" },
                    { time: 116.49, text: "'Cause this guy now is gone" },
                    { time: 120.63, text: "" },
                    { time: 121.02, text: "If you think I'm such a happy person, no" },
                    { time: 125, text: "You are wrong by saying my laughter is" },
                    { time: 128.31, text: "Louder than yours, shut your freakin mouth" },
                    { time: 130.48, text: "No one knows what I feel and what I suffer" },
                    { time: 134.12, text: "No they don't know, so keep your thoughts" },
                    { time: 138.42, text: "And stop assuming that, someone is always fine" },
                    { time: 141.01, text: "If you think I'm such a happy person, no" },
                    { time: 144.90, text: "You are wrong by saying my laughter is" },
                    { time: 148.22, text: "Louder than yours, shut your freakin mouth" },
                    { time: 151.48, text: "No one knows what I feel and what I suffer" },
                    { time: 154.28, text: "No they don't know" },
                    { time: 155.27, text: "So keep your thoughts and stop assuming that, someone is always fine" },
                    { time: 160.00, text: "(End of Song)" } 
                ]
            },
            {
                title: "Wish You Were Here - Neck Deep",
                timedLyrics: [
                    { time: 0.00, text: "" },
                    { time: 9.42, text: "Take it slow, tell me all how you've grown" },
                    { time: 13.01, text: "Just for me, could we all reminisce?" },
                    { time: 18.54, text: "Better yet, here's a pen, make a list" },
                    { time: 21.91, text: "Fill it full with all the things I've missed" },
                    { time: 25.82, text: "'Cause I can barely drive past the school without stopping to think of you" },
                    { time: 31.32, text: "And how we used to act the fool" },
                    { time: 35.15, text: "But worst of all, I wish I'd called at least a thousand times or more" },
                    { time: 40.61, text: "Just to hear what I've been missing" },
                    { time: 46.17, text: "If a picture is all that I have" },
                    { time: 51.16, text: "I can picture the times that we won't get back" },
                    { time: 55.70, text: "If I picture it now, it don't seem so bad" },
                    { time: 60.15, text: "Either way, I still wish you were here" },
                    { time: 64.66, text: "Don't say everything's meant to be" },
                    { time: 69.13, text: "'Cause you know it's not what I believe" },
                    { time: 72.69, text: "Can't help but think that it should've been me" },
                    { time: 77.10, text: "Either way, I still wish you were here" },
                    { time: 89.42, text: "Thinking back on the days where we all used to say" },
                    { time: 94.00, text: "\"I know anywhere's better than here\"" },
                    { time: 98.21, text: "In the back of the class where we grew up too fast" },
                    { time: 103.17, text: "Living life like there's nothin' to fear" },
                    { time: 107.12, text: "But the ice on the road, driving home all alone" },
                    { time: 111.89, text: "Singing along to a song from three summers ago" },
                    { time: 116.54, text: "The one that made you remember it" },
                    { time: 120.91, text: "Now I'll always remember it (I'll always remember it)" },
                    { time: 125.55, text: "As the song that your life ended with" },
                    { time: 132.21, text: "If a picture is all that I have" },
                    { time: 136.56, text: "I can picture the times that we won't get back" },
                    { time: 141.28, text: "If I picture it now, it don't seem so bad" },
                    { time: 145.74, text: "Either way, I still wish you were here" },
                    { time: 150.04, text: "Don't say everything's meant to be" },
                    { time: 154.51, text: "'Cause you know it's not what I believe" },
                    { time: 159.16, text: "Can't help but think that it should've been me" },
                    { time: 163.45, text: "Either way, I still wish you were here" },
                    { time: 167.84, text: "And they say you're in a better place (they say you're in a better place)" },
                    { time: 172.53, text: "But a better place is right here with me" },
                    { time: 176.90, text: "Yeah, they say you're in a better place (they say you're in a better place)" },
                    { time: 181.61, text: "Too bad it's not what I believe" },
                    { time: 186.38, text: "'Cause a picture is all that I have" },
                    { time: 190.95, text: "To remind me that you're never comin' back" },
                    { time: 195.30, text: "If I picture it now it just makes me sad" },
                    { time: 199.79, text: "And right now I just wish you were here" },
                    { time: 203.72, text: "Don't say everything's meant to be" },
                    { time: 208.26, text: "'Cause you know it's not what I believe" },
                    { time: 212.84, text: "Can't help but think that it should've been me" },
                    { time: 217.28, text: "In the end, I just wish you were here" },
                    { time: 222.44, text: "Yeah, they say you're in a better place (they say you're in a better place)" },
                    { time: 226.64, text: "Either way, I still wish you were here" },
                    { time: 230.69, text: "Don't say you're in a better place (they say you're in a better place)" },
                    { time: 235.37, text: "In the end, I just wish you were here" },
                    { time: 240.00, text: "(End of Song)" }
                ]
            }
        ];


        window.onload = () => {
          document.getElementById("notificationModal").style.display = "flex";
          preloadCardColors();
        };

        function closeModal(modalId) {
          document.getElementById(modalId).style.display = "none";
          if (modalId === 'lyricsModal') {
              clearInterval(lyricInterval);
              // Tambahkan jeda singkat sebelum mencoba scroll untuk mengatasi masalah tampilan
              setTimeout(() => {
                 lastLyricIndex = -1; // Reset index saat modal ditutup
              }, 100);
          }
        }

        document.getElementById("notificationModal").addEventListener("click", (e) => {
            if (e.target === e.currentTarget) closeModal('notificationModal');
        });
        document.getElementById("lyricsModal").addEventListener("click", (e) => {
            if (e.target === e.currentTarget) closeModal('lyricsModal');
        });

        /* SLIDER & PLAYER LOGIC */
        const items = document.querySelectorAll('input[name="slider"]');
        const songInfos = document.querySelectorAll(".song-info");
        const prevButton = document.getElementById("prev");
        const nextButton = document.getElementById("next");
        const pauseButton = document.getElementById("pause");
        const progressBars = document.querySelectorAll(".progress-bar"); 
        const progressEls = document.querySelectorAll(".progress");
        const volumeSlider = document.getElementById("volume-slider"); 
        const lyricsButton = document.getElementById("lyrics-btn");
        const lyricsTextContainer = document.getElementById("lyrics-text");
        const lyricsModalContent = document.getElementById("lyricsModalContent");

        const audios = [
            document.getElementById("audio-1"),
            document.getElementById("audio-2"),
            document.getElementById("audio-3"),
            document.getElementById("audio-4")
        ];
        
        let currentIndex = 0;
        let progressInterval;
        let lyricInterval; 
        let isPaused = true; 

        // DURASI
        const durations = [175, 270, 184, 240]; 

        function formatTime(seconds) {
          let m = Math.floor(Math.abs(seconds) / 60);
          let s = Math.floor(Math.abs(seconds) % 60);
          const sign = seconds < 0 ? "-" : "";
          return sign + m + ":" + (s < 10 ? "0" + s : s);
        }

        function updateTimeIndicatorDisplay(index, elapsed, remaining) {
            const indicator = songInfos[index].querySelector(".time-indicator");
            const elapsedSpan = indicator.querySelector(".elapsed");
            const remainingSpan = indicator.querySelector(".remaining");

            elapsedSpan.innerText = formatTime(elapsed);
            remainingSpan.innerText = formatTime(-remaining); 
        }

        function startProgressBar(el, index, currentPlaybackTime = 0) {
          clearInterval(progressInterval);
          
          const audio = audios[index];
          const totalSongTime = durations[index];
          
          audios.forEach((a, i) => {
              if (i !== index && !a.paused) {
                  a.pause();
                  if (i === currentIndex) clearInterval(lyricInterval); 
              }
          });
          
          if (!isPaused) {
              audio.currentTime = currentPlaybackTime;
              audio.play().catch(e => console.log("Audio play prevented:", e));
              pauseButton.classList.add('pulsing'); 
              startLyricSync(); 
          } else {
              audio.pause();
              pauseButton.classList.remove('pulsing'); 
              audio.currentTime = currentPlaybackTime;
              clearInterval(lyricInterval); 
          }
          
          let w = (audio.currentTime / totalSongTime) * 100;
          el.style.width = w + "%";
          updateTimeIndicatorDisplay(index, audio.currentTime, totalSongTime - audio.currentTime);


          const intervalDelay = 100; 

          progressInterval = setInterval(() => {
            if (audio.paused || audio.ended) {
                clearInterval(progressInterval);
                pauseButton.classList.remove('pulsing'); 
                clearInterval(lyricInterval); 
                if (audio.ended) {
                    setTimeout(() => {
                        nextButton.click();
                    }, 1000);
                }
                return;
            }
            
            let w = (audio.currentTime / totalSongTime) * 100;
            
            el.style.width = w + "%";
            updateTimeIndicatorDisplay(index, audio.currentTime, totalSongTime - audio.currentTime);
            
          }, intervalDelay);
        }

        function resetProgressBar(el, index) {
          clearInterval(progressInterval);
          clearInterval(lyricInterval); 
          pauseButton.classList.remove('pulsing'); 
          const audio = audios[index];
          
          audio.pause();
          audio.currentTime = 0; 

          el.style.width = "0%";
          const totalSeconds = durations[index];
          
          updateTimeIndicatorDisplay(index, 0, totalSeconds);
        }

        function updateActiveSong(index) {
          currentIndex = index; 
          items.forEach((item, i) => {
            if (i === index) {
              item.checked = true;
              songInfos[i].classList.add("active");
              
              startProgressBar(progressEls[i], i, audios[i].currentTime);
              
            } else {
              songInfos[i].classList.remove("active");
              resetProgressBar(progressEls[i], i);
            }
          });
          
          pauseButton.textContent = isPaused ? "‚ñ∫" : "‚ñê‚ñê";

          const card = document.getElementById(`song-${index + 1}`);
          if (card) {
            applySoftTheme(card);
          }
        }

        // --- Time Scrubbing Logic dengan Deep Sync Ganda ---
        progressBars.forEach((bar, index) => {
            bar.addEventListener("click", (e) => {
                if (index !== currentIndex) return;

                const audio = audios[currentIndex];
                const totalWidth = bar.offsetWidth;
                const clickX = e.clientX - bar.getBoundingClientRect().left;
                const percentage = clickX / totalWidth;
                const newTime = durations[currentIndex] * percentage;
                
                audio.currentTime = newTime;
                
                const curEl = progressEls[currentIndex];
                startProgressBar(curEl, currentIndex, audio.currentTime);
                
                if (document.getElementById("lyricsModal").style.display === "flex") {
                    // Pemaksaan Sinkronisasi 1 (Instan)
                    syncLyrics(true); 
                    
                    // Pemaksaan Sinkronisasi 2 (Setelah jeda singkat, untuk mengantisipasi delay rendering)
                    setTimeout(() => {
                        syncLyrics(true); 
                    }, 50); 
                }
            });
        });

        // --- SYNCHRONIZED LYRICS LOGIC ---
        function displayTimedLyrics(lyrics) {
            lyricsTextContainer.innerHTML = ''; 
            
            if (!lyrics || lyrics.length === 0) {
                lyricsTextContainer.innerHTML = '<p class="lyrics-line active">No timed lyrics available for this song.</p>';
                return;
            }

            lyrics.forEach((line, index) => {
                const p = document.createElement('p');
                p.classList.add('lyrics-line');
                p.dataset.time = line.time;
                p.dataset.index = index; 
                p.textContent = line.text === "" ? "..." : line.text; // Ganti baris kosong jadi "..."
                lyricsTextContainer.appendChild(p);
            });
        }
        
        let lastLyricIndex = -1;

        function syncLyrics(forceUpdate = false) {
            const audio = audios[currentIndex];
            // Tambahkan kondisi untuk berhenti jika audio belum dimuat (duration 0)
            if (audio.paused && !forceUpdate || isNaN(audio.duration) || audio.duration === 0) return;

            const currentTime = audio.currentTime;
            const timedLyrics = lyricsData[currentIndex].timedLyrics;
            const lyricLines = lyricsTextContainer.querySelectorAll('.lyrics-line');

            let activeLineIndex = -1;

            // Find the active line
            for (let i = 0; i < timedLyrics.length; i++) {
                if (currentTime >= timedLyrics[i].time) {
                    if (i === timedLyrics.length - 1 || currentTime < timedLyrics[i + 1].time) {
                        activeLineIndex = i;
                        break;
                    }
                }
            }
            
            // Logika Deep Sync: Cek apakah indeks berubah, atau jika ada lompatan besar (perbedaan > 5 baris), atau jika dipaksa update.
            const isDeepSync = forceUpdate || (activeLineIndex !== -1 && lastLyricIndex !== -1 && Math.abs(activeLineIndex - lastLyricIndex) > 5);

            if (activeLineIndex !== -1 && (activeLineIndex !== lastLyricIndex || forceUpdate || isDeepSync)) {
                
                // 1. Hapus kelas 'active' dari baris sebelumnya
                lyricLines.forEach(line => line.classList.remove('active'));
                
                // 2. Tambahkan kelas 'active' ke baris yang baru
                if (lyricLines[activeLineIndex]) {
                    lyricLines[activeLineIndex].classList.add('active');
                    
                    // 3. Auto-scroll (Hanya dilakukan jika ada perubahan indeks atau dipaksa update)
                    const activeLineEl = lyricLines[activeLineIndex];
                    const containerHeight = lyricsModalContent.clientHeight;
                    const lineTop = activeLineEl.offsetTop;
                    // Gulir agar baris aktif berada di sekitar 1/3 bagian atas modal
                    const scrollTarget = lineTop - (containerHeight / 3); 

                    lyricsModalContent.scrollTo({
                        top: scrollTarget,
                        // Gunakan 'auto' untuk lompatan besar (forceUpdate/Deep Sync) atau 'smooth' untuk transisi normal
                        behavior: isDeepSync ? 'auto' : 'smooth'
                    });
                    
                    // Update index terakhir HANYA SETELAH semua proses selesai
                    lastLyricIndex = activeLineIndex;
                }
            }
        }

        function startLyricSync() {
            clearInterval(lyricInterval); 
            if (!isPaused && document.getElementById("lyricsModal").style.display === "flex") {
                 // Reset lastLyricIndex saat memulai sinkronisasi untuk memastikan baris pertama segera aktif dan di-scroll
                 lastLyricIndex = -1; 
                 // Gunakan interval yang lebih cepat (misal 100ms) untuk sinkronisasi akurat 
                 lyricInterval = setInterval(syncLyrics, 100); 
            }
        }

        // --- LYRICS BUTTON LOGIC ---
        lyricsButton.addEventListener("click", () => {
            const currentLyrics = lyricsData[currentIndex];
            document.getElementById("lyrics-title").textContent = currentLyrics.title;
            
            displayTimedLyrics(currentLyrics.timedLyrics);
            
            document.getElementById("lyricsModal").style.display = "flex";
            
            // Theme application (CSS colors helper functions are defined below)
            const card = document.getElementById(`song-${currentIndex + 1}`);
            if (card) {
                const ar = parseInt(card.dataset.avgR || 200);
                const ag = parseInt(card.dataset.avgG || 200);
                const ab = parseInt(card.dataset.avgB || 200);
                const dr = parseInt(card.dataset.darkR || 70);
                const dg = parseInt(card.dataset.darkG || 70);
                const db = parseInt(card.dataset.darkB || 70);
                const [cr, cg, cb] = shiftLightness(ar, ag, ab, 0.6);
                const modalContent = document.getElementById("lyricsModalContent");
                modalContent.style.background = `rgb(${cr}, ${cg}, ${cb})`;
                modalContent.style.color = `rgb(${dr}, ${dg}, ${db})`;
                
                const modalCloseBtn = document.querySelector("#lyricsModal .modal-close");
                modalCloseBtn.style.backgroundColor = `rgb(${ar}, ${ag}, ${ab})`;
                modalCloseBtn.style.color = `rgb(${dr}, ${dg}, ${db})`;
                modalCloseBtn.onmouseover = () => {
                    modalCloseBtn.style.backgroundColor = `rgb(${dr}, ${dg}, ${db})`;
                    modalCloseBtn.style.color = `rgb(${cr}, ${cg}, ${cb})`;
                };
                modalCloseBtn.onmouseout = () => {
                    modalCloseBtn.style.backgroundColor = `rgb(${ar}, ${ag}, ${ab})`;
                    modalCloseBtn.style.color = `rgb(${dr}, ${dg}, ${db})`;
                };
            }
            
            // PENTING: Panggil syncLyrics(true) setelah modal terbuka
            startLyricSync();
            syncLyrics(true); 
        });


        prevButton.addEventListener("click", () => {
          currentIndex = (currentIndex - 1 + items.length) % items.length;
          isPaused = false; 
          pauseButton.textContent = "‚ñê‚ñê";
          updateActiveSong(currentIndex);
          if (document.getElementById("lyricsModal").style.display === "flex") {
            document.getElementById("lyrics-title").textContent = lyricsData[currentIndex].title;
            displayTimedLyrics(lyricsData[currentIndex].timedLyrics); 
            syncLyrics(true); 
          }
          startLyricSync(); 
        });

        nextButton.addEventListener("click", () => {
          currentIndex = (currentIndex + 1) % items.length;
          isPaused = false; 
          pauseButton.textContent = "‚ñê‚ñê";
          updateActiveSong(currentIndex);
          if (document.getElementById("lyricsModal").style.display === "flex") {
            document.getElementById("lyrics-title").textContent = lyricsData[currentIndex].title;
            displayTimedLyrics(lyricsData[currentIndex].timedLyrics); 
            syncLyrics(true); 
          }
          startLyricSync(); 
        });

        pauseButton.addEventListener("click", () => {
          const curEl = progressEls[currentIndex];
          const audio = audios[currentIndex];
          
          if (!isPaused) {
            clearInterval(progressInterval);
            clearInterval(lyricInterval); 
            audio.pause();
            isPaused = true;
            pauseButton.textContent = "‚ñ∫";
            pauseButton.classList.remove('pulsing');
          } else {
            isPaused = false;
            pauseButton.textContent = "‚ñê‚ñê";
            pauseButton.classList.add('pulsing');
            startProgressBar(curEl, currentIndex, audio.currentTime);
            startLyricSync(); 
          }
        });

        items.forEach((item, index) => {
            item.addEventListener('change', () => {
                if (item.checked) {
                    audios[currentIndex].pause(); 
                    isPaused = true; 
                    
                    updateActiveSong(index);
                }
            });
        });

        volumeSlider.addEventListener('input', () => {
            const volume = volumeSlider.value;
            audios.forEach(audio => {
                audio.volume = volume;
            });
            if (volume == 0) {
                document.getElementById("volume-icon").textContent = "üîá";
            } else if (volume < 0.5) {
                document.getElementById("volume-icon").textContent = "üîâ";
            } else {
                document.getElementById("volume-icon").textContent = "üîä";
            }
        });

        const favoriteBtn = document.getElementById("favorite");
        favoriteBtn.addEventListener("click", function () {
          this.classList.toggle("favorited");
          
          const card = document.getElementById(`song-${currentIndex + 1}`);
          if (card) {
             const dr = parseInt(card.dataset.darkR || 70);
             const dg = parseInt(card.dataset.darkG || 70);
             const db = parseInt(card.dataset.darkB || 70);
             this.style.color = this.classList.contains("favorited") ? "red" : `rgb(${dr}, ${dg}, ${db})`;
          }
        });

        function preloadCardColors() {
          const cards = document.querySelectorAll(".card");
          let cardsLoaded = 0;

          audios.forEach(audio => {
              audio.volume = volumeSlider.value;
          });

          cards.forEach((card) => {
            const img = card.querySelector("img");
            if (!img) return;

            img.crossOrigin = "anonymous"; 

            const handleImageLoad = () => {
                getAverageColor(img, (ar, ag, ab) => {
                    card.dataset.avgR = ar;
                    card.dataset.avgG = ag;
                    card.dataset.avgB = ab;

                    const [dr, dg, db] = shiftLightness(ar, ag, ab, -0.25);
                    card.dataset.darkR = dr;
                    card.dataset.darkG = dg;
                    card.dataset.darkB = db;

                    card.style.backgroundColor = `rgb(${ar}, ${ag}, ${ab})`;

                    cardsLoaded++;
                    if (cardsLoaded === cards.length) {
                        updateActiveSong(currentIndex);
                        isPaused = true; 
                        pauseButton.textContent = "‚ñ∫";
                        resetProgressBar(progressEls[currentIndex], currentIndex); 
                        updateModalTheme();
                    }
                });
            };
            
            img.onload = handleImageLoad;

            img.onerror = () => {
                const ar = 200, ag = 200, ab = 200;
                const dr = 70, dg = 70, db = 70;
                card.dataset.avgR = ar; card.dataset.avgG = ag; card.dataset.avgB = ab;
                card.dataset.darkR = dr; card.dataset.darkG = dg; card.dataset.darkB = db;
                card.style.backgroundColor = `rgb(${ar}, ${ag}, ${ab})`;

                cardsLoaded++;
                if (cardsLoaded === cards.length) {
                    updateActiveSong(currentIndex);
                    isPaused = true; 
                    pauseButton.textContent = "‚ñ∫";
                    resetProgressBar(progressEls[currentIndex], currentIndex); 
                    updateModalTheme();
                }
            };
            
            if (img.complete && img.naturalHeight !== 0) {
                handleImageLoad();
            }
          });
        }

        function updateModalTheme() {
          const firstCard = document.getElementById("song-1");
          if (firstCard) {
            const ar = firstCard.dataset.avgR || 200;
            const ag = firstCard.dataset.avgG || 200;
            const ab = firstCard.dataset.avgB || 200;
            const [lr, lg, lb] = shiftLightness(ar, ag, ab, 0.6);

            const modalContent = document.getElementById("modalContent");
            modalContent.style.background = `rgb(${lr}, ${lg}, ${lb})`;
            
            const dr = firstCard.dataset.darkR || 70;
            const dg = firstCard.dataset.darkG || 70;
            const db = firstCard.dataset.darkB || 70;
            modalContent.style.color = `rgb(${dr}, ${dg}, ${db})`;

             const modalCloseBtn = document.querySelector("#notificationModal .modal-close");
             modalCloseBtn.style.backgroundColor = `rgb(${ar}, ${ag}, ${ab})`;
             modalCloseBtn.style.color = `rgb(${dr}, ${dg}, ${db})`;
             modalCloseBtn.onmouseover = () => {
                 modalCloseBtn.style.backgroundColor = `rgb(${dr}, ${dg}, ${db})`;
                 modalCloseBtn.style.color = `rgb(${lr}, ${lg}, ${lb})`;
             };
             modalCloseBtn.onmouseout = () => {
                 modalCloseBtn.style.backgroundColor = `rgb(${ar}, ${ag}, ${ab})`;
                 modalCloseBtn.style.color = `rgb(${dr}, ${dg}, ${db})`;
             };
          }
        }

        function applySoftTheme(card) {
          const ar = parseInt(card.dataset.avgR || 200);
          const ag = parseInt(card.dataset.avgG || 200);
          const ab = parseInt(card.dataset.avgB || 200);

          const dr = parseInt(card.dataset.darkR || 70);
          const dg = parseInt(card.dataset.darkG || 70);
          const db = parseInt(card.dataset.darkB || 70);

          const container = document.querySelector(".container");
          const body = document.querySelector("body");

          const [lr, lg, lb] = shiftLightness(ar, ag, ab, 0.3);
          
          body.style.backgroundImage = `linear-gradient(135deg, rgb(${lr},${lg},${lb}) 0%, #ffffff 80%)`;

          container.style.color = `rgb(${dr}, ${dg}, ${db})`;
          const [cr, cg, cb] = shiftLightness(ar, ag, ab, 0.6);
          container.style.backgroundColor = `rgb(${cr},${cg},${cb})`;
          
          container.style.boxShadow = `8px 8px 16px rgba(${dr}, ${dg}, ${db}, 0.2), 
                                       -8px -8px 16px rgba(255, 255, 255, 0.9)`;

          const player = document.querySelector(".player");
          player.style.color = `rgb(${dr}, ${dg}, ${db})`;
          const [pr, pg, pb] = shiftLightness(ar, ag, ab, 0.45);
          player.style.backgroundColor = `rgb(${pr}, ${pg}, ${pb})`;
          
          player.style.boxShadow = `inset 5px 5px 10px rgba(${dr}, ${dg}, ${db}, 0.2), 
                                    inset -5px -5px 10px rgba(255, 255, 255, 0.9)`;

          const bars = document.querySelectorAll(".progress-bar");
          bars.forEach((bar) => {
            bar.style.backgroundColor = `rgb(${ar}, ${ag}, ${ab})`;
          });

          const fills = document.querySelectorAll(".progress");
          fills.forEach((fill) => {
            fill.style.backgroundColor = `rgb(${dr}, ${dg}, ${db})`;
          });

          const leftH1 = document.querySelector(".left-side h1");
          const leftP = document.querySelector(".left-side p");
          leftH1.style.color = `rgb(${dr}, ${dg}, ${db})`;
          leftP.style.color = `rgb(${dr}, ${dg}, ${db})`;

          const controlButtons = document.querySelectorAll(".controls button, .extra-controls button");
          controlButtons.forEach((btn) => {
            btn.style.color = `rgb(${dr}, ${dg}, ${db})`;
            btn.style.backgroundColor = `rgb(${pr}, ${pg}, ${pb})`; 
            
            const shadowStrength = btn.id === 'prev' || btn.id === 'pause' || btn.id === 'next' ? 4 : 3;
            btn.style.boxShadow = `${shadowStrength}px ${shadowStrength}px ${shadowStrength*2}px rgba(${dr}, ${dg}, ${db}, 0.2), 
                                   -${shadowStrength}px -${shadowStrength}px ${shadowStrength*2}px rgba(255, 255, 255, 0.9)`;
          
            btn.onmousedown = btn.ontouchstart = () => {
                btn.style.boxShadow = `inset 2px 2px 5px rgba(${dr}, ${dg}, ${db}, 0.2), 
                                       inset -2px -2px 5px rgba(255, 255, 255, 0.9)`;
            };
            btn.onmouseup = btn.ontouchend = () => {
                btn.style.boxShadow = `${shadowStrength}px ${shadowStrength}px ${shadowStrength*2}px rgba(${dr}, ${dg}, ${db}, 0.2), 
                                       -${shadowStrength}px -${shadowStrength}px ${shadowStrength*2}px rgba(255, 255, 255, 0.9)`;
            };
          });

          document.getElementById("volume-icon").style.color = `rgb(${dr}, ${dg}, ${db})`;

          const style = document.createElement('style');
          style.innerHTML = `
              #volume-slider::-webkit-slider-thumb {
                  background: rgb(${dr}, ${dg}, ${db}) !important;
              }
              .personal-note {
                  color: rgb(${dr}, ${dg}, ${db});
              }
          `;
          const oldStyle = document.head.querySelector('[data-style="volume-thumb"]');
          if (oldStyle) oldStyle.remove();
          style.setAttribute('data-style', 'volume-thumb');
          document.head.appendChild(style);

          favoriteBtn.style.color = favoriteBtn.classList.contains("favorited") ? "red" : `rgb(${dr}, ${dg}, ${db})`;
        }

        function shiftLightness(r, g, b, factor) {
          if (factor < -1) factor = -1;
          if (factor > 1) factor = 1;

          let { h, s, l } = rgbToHsl(r, g, b);

          l = l + factor * l;
          if (l < 0) l = 0;
          if (l > 1) l = 1;

          let { rr, gg, bb } = hslToRgb(h, s, l);
          return [Math.round(rr), Math.round(gg), Math.round(bb)];
        }

        function getAverageColor(img, cb) {
          const c = document.createElement("canvas");
          const ctx = c.getContext("2d");
          const tempImg = img;
          
          try {
            c.width = 100;
            c.height = 100;
            ctx.drawImage(tempImg, 0, 0, 100, 100);
            
            const data = ctx.getImageData(0, 0, c.width, c.height).data;
            let rSum = 0, gSum = 0, bSum = 0;
            const totalPixels = data.length / 4;

            for (let i = 0; i < data.length; i += 4) {
              rSum += data[i];
              gSum += data[i + 1];
              bSum += data[i + 2];
            }

            const rAvg = Math.floor(rSum / totalPixels);
            const gAvg = Math.floor(gSum / totalPixels);
            const bAvg = Math.floor(bSum / totalPixels);

            cb(rAvg, gAvg, bAvg);
          } catch(e) {
            console.error("Error getting average color (CORS issue likely):", e);
            cb(200, 200, 200);
          }
        }

        function rgbToHsl(r, g, b) {
          r /= 255; g /= 255; b /= 255;
          const max = Math.max(r, g, b);
          const min = Math.min(r, g, b);
          let h, s;
          let l = (max + min) / 2;

          if (max === min) {
            h = s = 0;
          } else {
            const d = max - min;
            s = l > 0.5 ? d / (2 - max - min) : d / (max + min);
            switch (max) {
              case r: h = (g - b) / d + (g < b ? 6 : 0); break;
              case g: h = (b - r) / d + 2; break;
              case b: h = (r - g) / d + 4; break;
            }
            h /= 6;
          }

          return { h, s, l };
        }

        function hslToRgb(h, s, l) {
          let r, g, b;
          if (s === 0) {
            r = g = b = l;
          } else {
            function hue2rgb(p, q, t) {
              if (t < 0) t += 1;
              if (t > 1) t -= 1;
              if (t < 1 / 6) return p + (q - p) * 6 * t;
              if (t < 1 / 2) return q;
              if (t < 2 / 3) return p + (q - p) * (2 / 3 - t) * 6;
              return p;
            }
            const q = l < 0.5 ? l * (1 + s) : l + s - l * s;
            const p = 2 * l - q;
            r = hue2rgb(p, q, h + 1 / 3);
            g = hue2rgb(p, q, h);
            b = hue2rgb(p, q, h - 1 / 3);
          }
          return { rr: r * 255, gg: g * 255, bb: b * 255 };
        }
    </script>
    </body>
</html>
